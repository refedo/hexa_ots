{% extends "admin/change_list.html" %}
{% load static %}

{% block content_title %}
    <h1>Raw Data Management</h1>
{% endblock %}

{% block object-tools %}
    <div style="margin-bottom: 20px;">
        <h2>Upload Raw Data</h2>
        <form action="upload-excel/" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div style="margin-bottom: 10px;">
                <label for="project">Project:</label>
                <select name="project" id="project" required>
                    <option value="">Select Project</option>
                    {% for project in projects %}
                        <option value="{{ project.id }}">{{ project.project_number }} - {{ project.project_name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div style="margin-bottom: 10px;">
                <label for="building">Building:</label>
                <select name="building" id="building" required>
                    <option value="">Select Building</option>
                </select>
            </div>
            <div style="margin-bottom: 10px;">
                <label for="excel_file">Excel File:</label>
                <input type="file" name="excel_file" id="excel_file" accept=".xlsx,.xls" required>
            </div>
            <div style="margin-bottom: 10px;">
                <button type="submit" class="button">Upload Excel</button>
                <a href="download-sample/" class="button" style="margin-left: 10px;">Download Sample File</a>
            </div>
        </form>
    </div>

    {{ block.super }}
{% endblock %}

{% block extrahead %}
{{ block.super }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const projectSelect = document.getElementById('project');
    const buildingSelect = document.getElementById('building');

    projectSelect.addEventListener('change', function() {
        const projectId = this.value;
        buildingSelect.innerHTML = '<option value="">Select Building</option>';
        
        if (projectId) {
            fetch(`/api/projects/${projectId}/buildings/`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(building => {
                        const option = document.createElement('option');
                        option.value = building.id;
                        option.textContent = building.building_name;
                        buildingSelect.appendChild(option);
                    });
                })
                .catch(error => console.error('Error:', error));
        }
    });
});
</script>
<style>
    select, input[type="file"] {
        width: 300px;
        padding: 5px;
        margin: 5px 0;
    }
    label {
        display: inline-block;
        width: 100px;
        font-weight: bold;
    }
    .button {
        background: #79aec8;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        color: #fff;
        cursor: pointer;
        text-decoration: none;
    }
    .button:hover {
        background: #609ab6;
    }
</style>
{% endblock %}
